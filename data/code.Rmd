## Đọc dữ liệu
```{r}
library(dplyr)
library(tidyr)
library(rmarkdown)
library(ggplot2)
old_data <- read.csv("usa.csv")
paged_table(old_data) # thay thế cho print, in ra bảng đẹp hơn
```
## Làm sạch dữ liệu (Data cleaning)
Ta bỏ cột index và cột location vì location luôn cố định (USA).
```{r}
new_data <- old_data %>% select(3:14)
paged_table(new_data)
```
### Trích xuất các dữ liệu chính
(Chỉ giữ lại các cột cần thiết, bao gồm 6 cột của biến dự đoán và cột biến ước lượng)
```{r}
main_data <- subset(new_data , select = c(new_deaths , new_cases , new_tests , icu_patients , hosp_patients , people_fully_vaccinated , positive_rate))
# paged_table(main_data)
```
### Xử lý dữ liệu khuyết (NA)

Ta tiến hành kiểm tra xem số lượng/tỉ lệ dữ liệu khuyết của mỗi thuộc tính là bao nhiêu. Nguyên nhân xuất hiện dữ liệu khuyết có thể xuất phát từ nhiều yếu tố, điển hình nhất là thiếu sót trong việc thu thập dữ liệu ngoài thực tế và nguồn tiếp cận dữ liệu bị hạn chế.

```{r}
main_data %>% sapply(function(col) sum(is.na(col)))    #Số dữ liệu bị khuyết theo cột
apply(main_data, 2, function(x)sum(is.na(x))/length(x))    #Tỉ lệ dữ liệu bị khuyết
```
Tỉ lệ dữ liệu khuyết tương đối cao, nếu chỉ đơn giản thay các giá trị NA bằng 0 thì kết quả thống kê sẽ bị ảnh hưởng rất nhiều. Để an toàn, ta sẽ loại bỏ hẳn các hàng có chứa ít nhất một dữ liệu khuyết.

```{r}
main_data <- na.omit(main_data)
# main_data[is.na(main_data)] <- 0    #NA <- 0
paged_table(main_data)
```

## Làm rõ dữ liệu

### Thống kê đơn biến
Thực hiện các phương pháp thống kê đơn biến lên từng biến dự đoán, 1 vài phương pháp: Summary Statistics, Frequency Distribution Table, Bar chart, Histogram... 

#### Summary Statistics
Ta tính các gía trị thống kê mô tả cho mỗi biến, bao gồm: trung bình (mean), trung vị (median), độ lệch chuẩn (sd), min, max

```{r}
stat_table<-apply(main_data[,c("new_deaths", "new_cases", "new_tests", "icu_patients", "hosp_patients", "people_fully_vaccinated", "positive_rate")], 2,
function(x){c(mean(x), median(x), sd(x), min(x), max(x))})
rownames(stat_table)<-c("mean", "median", "sd", "min", "max")
paged_table(as.data.frame(stat_table))
```

```{r}
plot_hist_norm <- function(data, var) {
  # Calculate the variable to plot
  plot_var <- data[[var]]
  
  # Histogram of the variable
  hist(plot_var, main = paste0("Histogram and Normal Curve of '", var, "'"),
       col = "blue", border = "white", xlab = "Cases", breaks = 20, freq = FALSE)
  # Normal curve overlay
  curve(dnorm(x, mean = mean(plot_var), sd = sd(plot_var)), 
        col = "red", lwd = 2, add = TRUE)
}
for (col_name in colnames(main_data)) {
  # Call plot_hist_norm on each column
  plot_hist_norm(main_data, col_name)
}
```

Dựa vào biểu đồ, ta nhận thấy giá trị của chúng bị lệch khá nhiều và không tuần theo phân phối chuẩn. Vì thế, ta thực hiện transform dữ liệu bằng hàm logarithm, với hi vọng là dữ liệu sao khi transform sẽ tuân theo phân phối chuẩn:

```{r}
plot_hist_norm_log <- function(data, var) {
  # Calculate the variable to plot
  plot_var <- log(data[[var]])
  
  # Histogram of the variable
  hist(plot_var, main = paste0("Histogram and Normal Curve of log(", var, ")"),
       col = "blue", border = "white", xlab = "Cases", breaks = 20, freq = FALSE)
  # Normal curve overlay
  curve(dnorm(x, mean = mean(plot_var), sd = sd(plot_var)), 
        col = "red", lwd = 2, add = TRUE)
}
for (col_name in colnames(main_data)) {
  # Call plot_hist_norm on each column
  plot_hist_norm_log(main_data, col_name)
}
```

### Thống kê đa biến

Ta tính ma trận hiệp phương sai của cả 7 biến này để kiểm tra sự phụ thuộc tuyến tính của từng cặp biến với nhau.

```{r}
paged_table(as.data.frame(cor(main_data)))
```

Dựng đồ thị mô tả sự tương quan giữa các biến (ở đây chọn 4 biến new_deaths, icu_patients, hosp_patients vì correlation giữa chúng tương đối cao). (THỬ NGHIỆM)

```{r}
contTab = subset(main_data, select = c(new_deaths, icu_patients, hosp_patients))
pairs(contTab)
```
Dựng đồ thị mô tả sự tương quan giữa các biến

# Xây dựng mô hình hồi quy bội
## Định nghĩa và ký hiệu cho mô hình

## Ước lượng tham số
Tính ra các hệ số của mô hình

## Ước lượng độ lệch chuẩn của sai số

## Xác định hệ số $R^2$ hiệu chỉnh

## Xác định khoảng tin cậy của các hệ số hồi quy

## Kiểm định đường hồi quy và các hệ số hồi quy

## Xác định khoảng tin cậy của giá trị trung bình của $Y$ khi $x=x_0$

## Xác định khoảng tin cậy của các giá trị dự đoán

## Kiểm định sự phù hợp của mô hình hồi quy tuyến tính